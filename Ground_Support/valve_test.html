<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SLURPL ‚Äî GROUND STATION</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#050810;
    --panel:#080d1a;
    --border:#1a2540;
    --border-bright:#1e3a6e;
    --amber:#ff8c00;
    --green:#00ff88;
    --red:#ff3333;
    --blue:#00aaff;
    --cyan:#00e5ff;
    --purple:#aa66ff;
    --text-primary:#c8d8f0;
    --text-dim:#4a6080;
    --text-mono:#7ab8ff;
    --glow-green:0 0 8px #00ff88,0 0 20px rgba(0,255,136,0.3);
    --glow-red:0 0 8px #ff3333,0 0 20px rgba(255,51,51,0.3);
    --glow-amber:0 0 8px #ff8c00,0 0 20px rgba(255,140,0,0.3);
    --glow-cyan:0 0 8px #00e5ff,0 0 20px rgba(0,229,255,0.3);
  }

  * {margin:0;padding:0;box-sizing:border-box;}

  body{
    background:var(--bg);
    color:var(--text-primary);
    font-family:'Rajdhani',sans-serif;
    height:100vh;
    overflow:hidden;
    background-image:
      linear-gradient(rgba(26,37,64,0.12) 1px,transparent 1px),
      linear-gradient(90deg,rgba(26,37,64,0.12) 1px,transparent 1px);
    background-size:40px 40px;
  }

  body::before{
    content:'';
    position:fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:repeating-linear-gradient(0deg,
    transparent,transparent 2px,
    rgba(0,0,0,0.08)2px,
    rgba(0,0,0,0.08)4px);
    pointer-events:none;
    z-index:1000;
  }

  /* HEADER */
  .header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px 32px;
    border-bottom:1px solid var(--border-bright);
    background:linear-gradient(180deg,rgba(0,20,60,0.85)0%,transparent 100%);
    position:relative;
    z-index:10;
  }

  .header::after{
    content:'';
    position:absolute;
    bottom:-1px;left:0;right:0;
    height:1px;
    background:linear-gradient(90deg,transparent,var(--blue),var(--cyan),var(--blue),transparent);
  }

  .logo-area{
    display:flex;
    align-items:center;
    gap:16px;
  }
  .logo-icon{
    width:40px;
    height:40px;
    border:2px solid var(--cyan);
    border-radius:4px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:17px;
    box-shadow:var(--glow-cyan);
    animation:pulseBorder 3s ease-in-out infinite;
  }

  @keyframes pulseBorder{
    0%,100%{box-shadow:var(--glow-cyan);}
    50%{box-shadow:0 0 18px #00e5ff,0 0 40px rgba(0,229,255,0.5);}
  }

  .system-title{
    font-family:'Orbitron',monospace;
    font-size:20px;
    font-weight:900;
    letter-spacing:4px;
    color:var(--cyan);
    text-shadow:0 0 10px rgba(0,229,255,0.6);
  }

  .system-sub{
    font-family:'Share Tech Mono',monospace;
    font-size:16px;
    color:var(--text-dim);
    letter-spacing:4px;
    margin-top:3px;
  }

  .header-right{
    display:flex;
    gap:28px;
    align-items:center;
  }
/* STATUS BADGES */
  .sbadge{
    display:flex;
    align-items:center;
    gap:8px;
    font-family:'Share Tech Mono',monospace;
    font-size:9px;
    letter-spacing:1px;
  }
  .sdot{
    width:7px;
    height:7px;
    border-radius:50%;
    animation:blinkdot 1.5s ease-in-out infinite;
  }

  .sdot.on{
    background:var(--green);
    box-shadow:var(--glow-green);
  }
  .sdot.sb{
    background:var(--amber);
    box-shadow:var(--glow-amber);
  }

  @keyframes blinkdot{0%,100%{opacity:1;}
  50%{opacity:0.35;}
}
  .htime{
    font-family:'Share Tech Mono',monospace;
    font-size:10px;
    color:var(--text-dim);
  }

  /* LAYOUT */
  .main-layout{
    display:grid;
    grid-template-columns:280px 1fr 280px;
    gap: 0;
    height:calc(100vh - 66px);
    overflow:hidden;
  }

  /* SIDE PANELS */
  .side-panel{
    border-right: 1px solid var(--border);
    padding:20px 16px;
    display:flex;
    flex-direction:column;
    gap:12px;
    overflow-y:auto;
    background:rgba(4,8,16,0.6);
  }

  .side-panel.right{
    border-right:none;
    border-left:1px solid var(--border);
  }

  .side-panel::-webkit-scrollbar{
    width:3px;
  }

  .side-panel::-webkit-scrollbar-thumb{
    background:var(--border-bright);
    border-radius:8px;
  }
  .stitle {
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    color: var(--text-dim);
    padding: 0 3px 5px;
    border-bottom: 1px solid var(--border);
  }

  /* TANK CARD */
  .tcard {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 20px 18px;
    position: relative;
    overflow: hidden;
  }

  .tcard::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: var(--ac, var(--blue));
    box-shadow: 0 0 5px var(--ac, var(--blue));
  }
  .tname {
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    color: var(--text-mono);
    font-weight: 700;
  }

  .tid {
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    margin-top: 1px;
  }

  .tval {
    font-family: 'Orbitron', monospace;
    font-size: 20px;
    font-weight: 900;
    line-height: 1;
    color: var(--ac, var(--blue));
    text-shadow: 0 0 7px var(--ac, var(--blue));
    margin: 4px 0 1px;
  }

  .tunit {
    font-family: 'Share Tech Mono', monospace;
    font-size: 8px;
    color: var(--text-dim);
    letter-spacing: 2px;
  }

  .tbar-track {
    margin-top: 6px;
    height: 4px;
    background: rgba(26, 37, 64, 0.8);
    border-radius: 3px;
    overflow: hidden;
    position: relative;
  }

  .tbar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.7s ease;
    background: var(--ac, var(--blue));
    box-shadow: 0 0 4px var(--ac, var(--blue));
    position: relative;
    overflow: hidden;
  }

  .tbar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 60%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s ease-in-out infinite;
  }

  @keyframes shimmer {
    0% {
      left: -100%;
    }
    100% {
      left: 200%;
    }
  }

  .tbar-lbls {
    display: flex;
    justify-content: space-between;
    margin-top: 2px;
    font-family: 'Share Tech Mono', monospace;
    font-size:18px;
    color: var(--text-dim);
  }

  .tstatus-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
  }

  .tstlbl {
    font-family: 'Share Tech Mono', monospace;
    font-size: 10 px;
    letter-spacing: 1px;
  }

  .snom {
    color: var(--green);
  }

  .swarn {
    color: var(--amber);
  }

  .scrit {
    color: var(--red);
  }

  .ttrend {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    color: var(--text-dim);
  }

  .sparkline {
    width: 100%;
    height: 20px;
    margin-top: 3px;
  }

  /* VALVE CARD */
  .vcard {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .vcard::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: var(--vc, var(--amber));
    box-shadow: 0 0 5px var(--vc, var(--amber));
  }

  .vcard:hover {
    border-color: var(--border-bright);
    transform: translateX(2px);
  }

  .vcard:active {
    transform: scale(0.98);
  }

  .vleft {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .vicon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    border: 1px solid var(--border-bright);
    border-radius: 3px;
    background: rgba(10, 20, 40, 0.8);
  }

  .vname {
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    letter-spacing: 1.5px;
    color: var(--text-mono);
    font-weight: 700;
  }

  .vid {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    color: var(--text-dim);
    margin-top: 1px;
  }

  .vtoggle {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 3px;
  }

  .vpill {
    font-family: 'Share Tech Mono', monospace;
    font-size: 7px;
    letter-spacing: 1.5px;
    padding: 2px 5px;
    border-radius: 2px;
    font-weight: bold;
    transition: all 0.3s;
  }

  .pclosed {
    background: rgba(255, 51, 51, 0.12);
    color: var(--red);
    border: 1px solid var(--red);
    box-shadow: 0 0 3px rgba(255, 51, 51, 0.3);
  }

  .popen {
    background: rgba(0, 255, 136, 0.12);
    color: var(--green);
    border: 1px solid var(--green);
    box-shadow: 0 0 3px rgba(0, 255, 136, 0.3);
  }

  .pengaged {
    background: rgba(0, 255, 136, 0.12);
    color: var(--green);
    border: 1px solid var(--green);
    box-shadow: 0 0 3px rgba(0, 255, 136, 0.3);
  }

  .pdisengaged {
    background: rgba(255, 51, 51, 0.12);
    color: var(--red);
    border: 1px solid var(--red);
    box-shadow: 0 0 3px rgba(255, 51, 51, 0.3);
  }
/* TOGGLE SWITCH */
  .tswitch {
    position: relative;
    width: 30px;
    height: 14px;
    background: rgba(20, 30, 50, 0.8);
    border-radius: 7px;
    border: 1px solid var(--border-bright);
    cursor: pointer;
    transition: all 0.3s;
    overflow: hidden;
  }

  .tswitch.active {
    background: rgba(0, 255, 136, 0.2);
    border-color: var(--green);
    box-shadow: 0 0 4px rgba(0, 255, 136, 0.4);
  }

  .tknob {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 8px;
    height: 8px;
    background: var(--text-dim);
    border-radius: 50%;
    transition: all 0.3s;
  }

  .tswitch.active .tknob {
    left: 20px;
    background: var(--green);
    box-shadow: 0 0 3px var(--green);
  }
/* CENTER AREA */
  .center-area {
    padding: 9px 13px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow: hidden;
  }
/* TELEMETRY BAR */
  .trow {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    flex-shrink: 0;
  }

  .tcell {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
  }

  .tlbl {
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--text-dim);
    text-transform: uppercase;
  }

  .tval2 {
    font-family: 'Orbitron', monospace;
    font-size: 18px;
    font-weight: 900;
    color: var(--cyan);
    text-shadow: var(--glow-cyan);
    margin: 2px 0 1px;
  }

  .tsub {
    font-family: 'Share Tech Mono', monospace;
    font-size: 6px;
    color: var(--text-dim);
  }
/* SCHEMATIC DIAGRAM */
  .schematic {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 50px;
    position: relative;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  .schematic-title {
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    color: var(--text-dim);
    position: absolute;
    top: 7px;
    left: 10px;
    z-index: 5;
  }

  #sys-svg {
    width: 100%;
    height: 100%;
  }

  .cdeco {
    position: absolute;
    width: 12px;
    height: 12px;
    border-color: var(--border-bright);
    border-style: solid;
  }

  .cdeco.tl {
    top: 5px;
    left: 5px;
    border-width: 1px 0 0 1px;
  }

  .cdeco.tr {
    top: 5px;
    right: 5px;
    border-width: 1px 1px 0 0;
  }

  .cdeco.bl {
    bottom: 5px;
    left: 5px;
    border-width: 0 0 1px 1px;
  }

  .cdeco.br {
    bottom: 5px;
    right: 5px;
    border-width: 0 1px 1px 0;
  }

  /* LOG PANEL */

  .log-row {
    display: flex;
    flex-direction: column;
    gap: 3px;
    flex-shrink: 0;
  }

  .log-hdr {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .log-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 10px;
    height: 160px;
    overflow-y: auto;
  }

  .log-panel::-webkit-scrollbar {
    width: 4px;
  }

  .log-panel::-webkit-scrollbar-thumb {
    background: var(--border-bright);
  }

  .lentry {
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    padding: 4px 0;
    border-bottom: 1px solid rgba(26, 37, 64, 0.4);
    display: flex;
    gap: 10px;
    animation: lfade 0.3s ease;
  }

  @keyframes lfade {
    from {
      opacity: 0;
      transform: translateX(-3px);
    }
    to {
      opacity: 1;
      transform: none;
    }
  }

  .lt {
    color: var(--text-dim);
    min-width: 58px;
  }

  .lok {
    color: var(--green);
  }

  .lwarn {
    color: var(--amber);
  }

  .lerr {
    color: var(--red);
  }

  .linfo {
    color: var(--blue);
  }
/* CONTROL BUTTONS */
  .cbtn {
    width: 100%;
    padding: 6px;
    border-radius: 3px;
    cursor: pointer;
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    transition: filter 0.2s;
  }

  .cbtn:hover {
    filter: brightness(1.3);
  }

  .inj-inp {
    width: 100%;
    background: var(--panel);
    border: 1px solid var(--border-bright);
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    padding: 3px 5px;
    border-radius: 3px;
  }

  .inj-lbl {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    color: var(--text-dim);
    margin-bottom: 2px;
  }
/* TOAST NOTIFICATIONS */
  .toast {
    position: fixed;
    top: 63px;
    right: 13px;
    background: var(--panel);
    border: 1px solid var(--border-bright);
    border-radius: 4px;
    padding: 7px 11px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    z-index: 500;
    display: flex;
    gap: 7px;
    align-items: center;
    transform: translateX(130%);
    transition: transform 0.3s ease;
    max-width: 250px;
  }

  .toast.show {
    transform: translateX(0);
  }

  .armed {
    background: rgba(255, 51, 51, 0.1);
    border: 1px solid var(--red);
    border-radius: 3px;
    padding: 4px;
    font-family: 'Orbitron', monospace;
    font-size: 7px;
    letter-spacing: 3px;
    color: var(--red);
    text-align: center;
    animation: blinkdot 1s ease-in-out infinite;
    margin-bottom: 3px;
    display: none;
  }

  .armed.on {
    display: block;
  }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="logo-area">
    <div class="logo-icon">‚öô</div>
    <div>
      <div class="system-title">SLURPL - ROCKET PROPULSION LAB</div>
      <div class="system-sub">GROUND STATION ¬∑ VALVE CONTROL SYSTEM</div>
    </div>
  </div>
  <div class="header-right">
    <div class="sbadge"><div class="sdot on"></div><span>TELEMETRY</span></div>
    <div class="sbadge"><div class="sdot sb"></div><span>STANDBY</span></div>
    <div class="htime" id="clock">--:--:-- UTC</div>
  </div>
</div>

<div class="main-layout">

  <!-- LEFT PANEL: TANKS -->
  <div class="side-panel">
    <div class="stitle">‚óà PRESSURE TANKS</div>

    <div class="tcard" style="--ac:#ff5533;">
      <div class="tname">N‚ÇÇO PRESSURE</div><div class="tid">TANK-A ¬∑ NITROUS OXIDE</div>
      <div class="tval" id="n2o-val" style="color:#ff5533;text-shadow:0 0 7px #ff5533;">‚Äî</div>
      <div class="tunit">PSI</div>
      <div class="tbar-track"><div class="tbar-fill" id="n2o-bar" style="width:0%;background:#ff5533;box-shadow:0 0 4px #ff5533;"></div></div>
      <div class="tbar-lbls"><span>0</span><span>500</span><span>1000</span><span>1500</span></div>
      <svg class="sparkline" viewBox="0 0 200 20" preserveAspectRatio="none"><polyline id="sp-n2o" points="" fill="none" stroke="#ff5533" stroke-width="1.5" opacity="0.7"/></svg>
      <div class="tstatus-row"><span class="tstlbl snom" id="n2o-status">‚óè NOMINAL</span><span class="ttrend" id="n2o-trend">‚Üî</span></div>
    </div>

    <div class="tcard" style="--ac:#00aaff;">
      <div class="tname">N‚ÇÇ PRESSURE</div><div class="tid">TANK-B ¬∑ NITROGEN</div>
      <div class="tval" id="n2-val">‚Äî</div><div class="tunit">PSI</div>
      <div class="tbar-track"><div class="tbar-fill" id="n2-bar" style="width:0%;"></div></div>
      <div class="tbar-lbls"><span>0</span><span>500</span><span>1000</span><span>1500</span></div>
      <svg class="sparkline" viewBox="0 0 200 20" preserveAspectRatio="none"><polyline id="sp-n2" points="" fill="none" stroke="#00aaff" stroke-width="1.5" opacity="0.7"/></svg>
      <div class="tstatus-row"><span class="tstlbl snom" id="n2-status">‚óè NOMINAL</span><span class="ttrend" id="n2-trend">‚Üî</span></div>
    </div>

    <div class="tcard" style="--ac:#00ff88;">
      <div class="tname">OX PRESSURE</div><div class="tid">TANK-C ¬∑ OXYGEN</div>
      <div class="tval" id="o2-val" style="color:#00ff88;text-shadow:0 0 7px #00ff88;">‚Äî</div><div class="tunit">PSI</div>
      <div class="tbar-track"><div class="tbar-fill" id="o2-bar" style="width:0%;background:#00ff88;box-shadow:0 0 4px #00ff88;"></div></div>
      <div class="tbar-lbls"><span>0</span><span>500</span><span>1000</span><span>1500</span></div>
      <svg class="sparkline" viewBox="0 0 200 20" preserveAspectRatio="none"><polyline id="sp-o2" points="" fill="none" stroke="#00ff88" stroke-width="1.5" opacity="0.7"/></svg>
      <div class="tstatus-row"><span class="tstlbl snom" id="o2-status">‚óè NOMINAL</span><span class="ttrend" id="o2-trend">‚Üî</span></div>
    </div>

    <div class="tcard" style="--ac:#ff8800;">
      <div class="tname">COMB. CHAMBER</div><div class="tid">CC-01 ¬∑ CHAMBER PRESSURE</div>
      <div class="tval" id="cc-val" style="color:#ff8800;text-shadow:0 0 7px #ff8800;">‚Äî</div><div class="tunit">PSI</div>
      <div class="tbar-track"><div class="tbar-fill" id="cc-bar" style="width:0%;background:#ff8800;box-shadow:0 0 4px #ff8800;"></div></div>
      <div class="tbar-lbls"><span>0</span><span>500</span><span>1000</span><span>1500</span></div>
      <div class="tstatus-row"><span class="tstlbl snom" id="cc-status">‚óè NOMINAL</span><span class="ttrend" id="cc-trend">‚Üî</span></div>
    </div>
  </div>

  <!-- CENTER: SCHEMATIC + TELEM + LOG -->
  <div class="center-area">

    <!-- TELEMETRY BAR -->
    <div class="trow">
      <div class="tcell"><div class="tlbl">SYS AVG</div><div class="tval2" id="t-sys">--</div><div class="tsub">PSI</div></div>
      <div class="tcell"><div class="tlbl">OPEN VALVES</div><div class="tval2" id="t-valves" style="color:var(--green);text-shadow:var(--glow-green)">0</div><div class="tsub">OF 6</div></div>
      <div class="tcell"><div class="tlbl">UPTIME</div><div class="tval2" id="t-uptime" style="color:var(--amber);text-shadow:var(--glow-amber)">00:00</div><div class="tsub">MIN:SEC</div></div>
      <div class="tcell"><div class="tlbl">EVENTS</div><div class="tval2" id="t-events" style="color:var(--red);text-shadow:var(--glow-red)">0</div><div class="tsub">LOGGED</div></div>
    </div>

    <!-- SCHEMATIC DIAGRAM -->
    <div class="schematic">
      <div class="cdeco tl"></div><div class="cdeco tr"></div>
      <div class="cdeco bl"></div><div class="cdeco br"></div>
      <div class="schematic-title">P&ID SCHEMATIC </div>

      <!--
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        TOPOLOGY:
          N2O [cyl] ‚îÄ‚îÄ‚ñ∫ N2OV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                  MERGE ‚îÄ‚îÄ‚ñ∫ SOL1 ‚îÄ‚îÄ‚ñ∫ QD ‚îÄ‚îÄ‚ñ∫ OX [cyl]
          N2  [cyl] ‚îÄ‚îÄ‚ñ∫ N2V  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  (one pt)              ‚îÇ    ‚îÇ
                     (rise to merge)                       SOL2  (vert)
                                                            ‚îÇ
                                                           MEV
                                                            ‚îÇ
                                                       CC [horiz cyl]
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      -->

      <svg id="sys-svg" viewBox="0 0 640 328" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="fr" x="-80%" y="-80%" width="260%" height="260%"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="fb" x="-80%" y="-80%" width="260%" height="260%"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="fg" x="-80%" y="-80%" width="260%" height="260%"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="fc" x="-80%" y="-80%" width="260%" height="260%"><feGaussianBlur stdDeviation="3.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <style>
            .pipe{fill:none;stroke:#1a2d50;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;}
            .pipe-on{fill:none;stroke-width:2.8;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:9 4;animation:flowanim .65s linear infinite;}
            @keyframes flowanim{from{stroke-dashoffset:0;}to{stroke-dashoffset:-26;}}
            .clbl{font-family:'Share Tech Mono',monospace;font-size:8px;fill:#3d5070;letter-spacing:0.5px;}
            .ctit{font-family:'Orbitron',monospace;font-size:7.5px;font-weight:bold;letter-spacing:1px;}
            .cst {font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:0.8px;}
          </style>
        </defs>

        <pattern id="pg" width="18" height="18" patternUnits="userSpaceOnUse">
          <path d="M18 0L0 0 0 18" fill="none" stroke="rgba(26,45,80,0.2)" stroke-width="0.5"/>
        </pattern>
        <rect width="640" height="328" fill="url(#pg)"/>

        <!-- ‚îÄ‚îÄ‚îÄ PIPES (drawn first, behind all components) ‚îÄ‚îÄ‚îÄ -->

        <!-- px1 : N2O right-port ‚Üí N2OV entry -->
        <line id="px1" class="pipe" x1="92"  y1="152" x2="112" y2="152"/>
        <!-- px2 : N2OV exit ‚Üí merge point -->
        <line id="px2" class="pipe" x1="144" y1="152" x2="192" y2="152"/>
        <!-- px3 : N2 right-port ‚Üí N2V entry -->
        <line id="px3" class="pipe" x1="92"  y1="268" x2="112" y2="268"/>
        <!-- px4 : N2V exit ‚Üí elbow base -->
        <line id="px4" class="pipe" x1="144" y1="268" x2="192" y2="268"/>
        <!-- px5 : N2 vertical rise to merge (x=192) -->
        <line id="px5" class="pipe" x1="192" y1="268" x2="192" y2="152"/>
        <!-- px6 : merge ‚Üí SOL1 entry -->
        <line id="px6" class="pipe" x1="192" y1="152" x2="228" y2="152"/>
        <!-- px8 : SOL1 exit ‚Üí QD entry -->
        <line id="px8" class="pipe" x1="266" y1="152" x2="300" y2="152"/>
        <!-- px9 : QD exit ‚Üí OX left port  ‚Üê STRAIGHT HORIZONTAL, no vertical detour -->
        <line id="px9" class="pipe" x1="336" y1="152" x2="453" y2="152"/>

        <!-- px11: OX bottom port ‚Üí SOL2 entry -->
        <line id="px11" class="pipe" x1="490" y1="175" x2="490" y2="193"/>
        <!-- px12: SOL2 exit ‚Üí MEV entry -->
        <line id="px12" class="pipe" x1="490" y1="225" x2="490" y2="244"/>
        <!-- px13: MEV exit ‚Üí CC top port -->
        <line id="px13" class="pipe" x1="490" y1="280" x2="490" y2="293"/>


        <!-- ‚îÄ‚îÄ‚îÄ N2O CYLINDER ‚îÄ‚îÄ‚îÄ -->
        <g id="svg-tank-n2o">
          <rect x="18" y="105" width="74" height="93" fill="#0d0508" stroke="#ff5533" stroke-width="1.6"/>
          <rect x="18" y="105" width="4"  height="93" rx="1" fill="#ff5533" opacity="0.7"/>
          <ellipse cx="55" cy="105" rx="37" ry="10" fill="#140608" stroke="#ff5533" stroke-width="1.6"/>
          <ellipse cx="55" cy="198" rx="37" ry="10" fill="#0f0508" stroke="#ff5533" stroke-width="1.6"/>
          <ellipse cx="55" cy="105" rx="28" ry="6"  fill="none" stroke="rgba(255,85,51,0.2)" stroke-width="1"/>
          <text x="55" y="145" text-anchor="middle" class="ctit" fill="#ff5533">N2O</text>
          <text x="55" y="160" text-anchor="middle" class="clbl">TANK-A</text>
          <text id="svp-n2o" x="55" y="177" text-anchor="middle" style="font-family:'Share Tech Mono',monospace;font-size:8px;fill:#ff5533">‚Äî PSI</text>
          <circle cx="92" cy="152" r="3.5" fill="#ff5533"/>
        </g>

        <!-- ‚îÄ‚îÄ‚îÄ N2 CYLINDER ‚îÄ‚îÄ‚îÄ -->
        <g id="svg-tank-n2">
          <rect x="18" y="240" width="74" height="80" fill="#040810" stroke="#00aaff" stroke-width="1.6"/>
          <rect x="18" y="240" width="4"  height="80" rx="1" fill="#00aaff" opacity="0.7"/>
          <ellipse cx="55" cy="240" rx="37" ry="10" fill="#040b14" stroke="#00aaff" stroke-width="1.6"/>
          <ellipse cx="55" cy="318" rx="37" ry="10" fill="#040810" stroke="#00aaff" stroke-width="1.6"/>
          <ellipse cx="55" cy="240" rx="28" ry="6"  fill="none" stroke="rgba(0,170,255,0.2)" stroke-width="1"/>
          <text x="55" y="272" text-anchor="middle" class="ctit" fill="#00aaff">N2</text>
          <text x="55" y="287" text-anchor="middle" class="clbl">TANK-B</text>
          <text id="svp-n2" x="55" y="303" text-anchor="middle" style="font-family:'Share Tech Mono',monospace;font-size:8px;fill:#00aaff">‚Äî PSI</text>
          <circle cx="92" cy="268" r="3.5" fill="#00aaff"/>
        </g>

        <!-- ‚îÄ‚îÄ‚îÄ OX CYLINDER ‚îÄ‚îÄ‚îÄ
             Left port at y=152 (aligns with main horizontal line).
             Bottom port at (490, 175) feeds the SOL2 ‚Üí MEV ‚Üí CC vertical line. -->
        <g id="svg-tank-ox">
          <rect x="453" y="22" width="74" height="143" fill="#040d08" stroke="#00ff88" stroke-width="1.6"/>
          <rect x="453" y="22" width="74" height="4"   rx="1" fill="#00ff88" opacity="0.7"/>
          <ellipse cx="490" cy="22"  rx="37" ry="10" fill="#050f08" stroke="#00ff88" stroke-width="1.6"/>
          <ellipse cx="490" cy="165" rx="37" ry="10" fill="#04110a" stroke="#00ff88" stroke-width="1.6"/>
          <ellipse cx="490" cy="22"  rx="28" ry="6"  fill="none" stroke="rgba(0,255,136,0.2)" stroke-width="1"/>
          <text x="490" y="62"  text-anchor="middle" class="ctit" fill="#00ff88">OX TANK</text>
          <text x="490" y="77"  text-anchor="middle" class="clbl">TANK-C</text>
          <text id="svp-ox" x="490" y="94" text-anchor="middle" style="font-family:'Share Tech Mono',monospace;font-size:8px;fill:#00ff88">‚Äî PSI</text>
          <!-- left port (QD pipe enters here, y=152) -->
          <circle cx="453" cy="152" r="3.5" fill="#aa88ff"/>
          <!-- bottom port (SOL2 pipe exits here) -->
          <circle cx="490" cy="175" r="3.5" fill="#00ff88"/>
        </g>

        <!-- ‚îÄ‚îÄ‚îÄ CC HORIZONTAL CYLINDER ‚îÄ‚îÄ‚îÄ -->
        <g id="svg-cc">
          <rect x="425" y="293" width="130" height="28" fill="#120800" stroke="#ff8800" stroke-width="1.6"/>
          <rect x="425" y="293" width="130" height="4"  rx="1" fill="#ff8800" opacity="0.7"/>
          <!-- left end cap -->
          <ellipse cx="425" cy="307" rx="10" ry="14" fill="#100700" stroke="#ff8800" stroke-width="1.6"/>
          <!-- right end cap -->
          <ellipse cx="555" cy="307" rx="10" ry="14" fill="#100700" stroke="#ff8800" stroke-width="1.6"/>
          <ellipse cx="425" cy="307" rx="6"  ry="8"  fill="none" stroke="rgba(255,136,0,0.18)" stroke-width="1"/>
          <ellipse cx="555" cy="307" rx="6"  ry="8"  fill="none" stroke="rgba(255,136,0,0.18)" stroke-width="1"/>
          <text x="490" y="308" text-anchor="middle" class="ctit" fill="#ff8800" font-size="7">COMBUSTION CHAMBER</text>
          <text id="svp-cc" x="490" y="319" text-anchor="middle" style="font-family:'Share Tech Mono',monospace;font-size:7px;fill:#ff8800">‚Äî PSI</text>
          <circle cx="490" cy="293" r="3.5" fill="#00e5ff"/>
        </g>


        <!-- ‚îÄ‚îÄ‚îÄ VALVE SYMBOLS ‚îÄ‚îÄ‚îÄ -->

        <!-- N2OV: horizontal ball valve -->
        <g id="svc-n2ov" style="cursor:pointer" onclick="toggleValve('n2o-valve')" title="N2O Valve">
          <circle cx="128" cy="152" r="16" id="c-n2ov" fill="#0a0d12" stroke="#ff8c00" stroke-width="1.8"/>
          <polygon id="bt-n2ov-l" points="113,144 128,152 113,160" fill="#ff8c00" opacity="0.75"/>
          <polygon id="bt-n2ov-r" points="143,144 128,152 143,160" fill="#ff8c00" opacity="0.75"/>
          <text id="st-n2ov" x="128" y="130" text-anchor="middle" class="cst" fill="#ff3333">CLOSED</text>
          <text x="128" y="181" text-anchor="middle" class="clbl" fill="#ff8c00">N2OV</text>
        </g>

        <!-- N2V: horizontal ball valve -->
        <g id="svc-n2v" style="cursor:pointer" onclick="toggleValve('n2-valve')" title="N2 Valve">
          <circle cx="128" cy="268" r="16" id="c-n2v" fill="#040810" stroke="#00aaff" stroke-width="1.8"/>
          <polygon id="bt-n2v-l" points="113,260 128,268 113,276" fill="#00aaff" opacity="0.75"/>
          <polygon id="bt-n2v-r" points="143,260 128,268 143,276" fill="#00aaff" opacity="0.75"/>
          <text id="st-n2v" x="128" y="246" text-anchor="middle" class="cst" fill="#ff3333">CLOSED</text>
          <text x="128" y="297" text-anchor="middle" class="clbl" fill="#00aaff">N2V</text>
        </g>

        <!-- SOL1: coil-box ABOVE + horizontal valve on pipe -->
        <g id="svc-sol1" style="cursor:pointer" onclick="toggleValve('solenoid-1')" title="Solenoid 1">
          <rect x="228" y="95" width="38" height="28" rx="2" id="box-sol1" fill="#0b0814" stroke="#bb44ff" stroke-width="1.5"/>
          <text x="247" y="108" text-anchor="middle" class="ctit" fill="#bb44ff" font-size="9">S</text>
          <text x="247" y="119" text-anchor="middle" class="clbl" fill="#bb44ff" font-size="7">SOL1</text>
          <line x1="247" y1="123" x2="247" y2="136" stroke="#bb44ff" stroke-width="1.2" stroke-dasharray="2 2"/>
          <circle cx="247" cy="152" r="16" id="c-sol1" fill="#0b0814" stroke="#bb44ff" stroke-width="1.8"/>
          <polygon id="bt-sol1-l" points="232,144 247,152 232,160" fill="#bb44ff" opacity="0.75"/>
          <polygon id="bt-sol1-r" points="262,144 247,152 262,160" fill="#bb44ff" opacity="0.75"/>
          <text id="st-sol1" x="247" y="182" text-anchor="middle" class="cst" fill="#ff3333">CLOSED</text>
        </g>

        <!-- QD: Quick Disconnect (two plug halves + gap arrows) -->
        <g id="svc-qd" style="cursor:pointer" onclick="toggleValve('quick-disconnect')" title="Quick Disconnect">
          <rect x="301" y="145" width="13" height="14" rx="2" id="qd-lh" fill="#0a0906" stroke="#f39c12" stroke-width="1.5"/>
          <line x1="301" y1="148" x2="301" y2="156" stroke="#f39c12" stroke-width="1.8"/>
          <rect x="322" y="145" width="13" height="14" rx="2" id="qd-rh" fill="#0a0906" stroke="#f39c12" stroke-width="1.5"/>
          <line x1="335" y1="148" x2="335" y2="156" stroke="#f39c12" stroke-width="1.8"/>
          <text id="qd-al" x="315" y="155" text-anchor="middle" font-size="9" fill="#ff3333" font-family="monospace">‚üµ</text>
          <text id="qd-ar" x="321" y="155" text-anchor="middle" font-size="9" fill="#ff3333" font-family="monospace">‚ü∂</text>
          <text id="st-qd" x="318" y="133" text-anchor="middle" class="cst" fill="#ff3333">DISENGAGED</text>
          <text x="318" y="174" text-anchor="middle" class="clbl" fill="#f39c12">QD-01</text>
        </g>

        <!-- SOL2: coil-box to the RIGHT + vertical ball valve on pipe
             (mirrors SOL1 layout: SOL1 has box above horiz pipe, SOL2 has box right of vert pipe) -->
        <g id="svc-sol2" style="cursor:pointer" onclick="toggleValve('solenoid-2')" title="Solenoid 2">
          <!-- coil box: to the RIGHT of the vertical pipe -->
          <rect x="509" y="196" width="38" height="26" rx="2" id="box-sol2" fill="#0b0814" stroke="#bb44ff" stroke-width="1.5"/>
          <text x="528" y="208" text-anchor="middle" class="ctit" fill="#bb44ff" font-size="9">S</text>
          <text x="528" y="219" text-anchor="middle" class="clbl" fill="#bb44ff" font-size="7">SOL2</text>
          <!-- horizontal dashed actuator line: box left edge ‚Üí valve right edge -->
          <line x1="509" y1="209" x2="506" y2="209" stroke="#bb44ff" stroke-width="1.2" stroke-dasharray="2 2"/>
          <!-- vertical ball valve on pipe (cx=490, cy=209) -->
          <circle cx="490" cy="209" r="16" id="c-sol2" fill="#0b0814" stroke="#bb44ff" stroke-width="1.8"/>
          <!-- vertical bowtie: top & bottom triangles -->
          <polygon id="bt-sol2-t" points="482,194 490,209 498,194" fill="#bb44ff" opacity="0.75"/>
          <polygon id="bt-sol2-b" points="482,224 490,209 498,224" fill="#bb44ff" opacity="0.75"/>
          <text id="st-sol2" x="490" y="189" text-anchor="middle" class="cst" fill="#ff3333">CLOSED</text>
        </g>

        <!-- MEV: vertical ball valve (unchanged position relative to CC) -->
        <g id="svc-mev" style="cursor:pointer" onclick="toggleValve('main-engine-valve')" title="Main Engine Valve">
          <circle cx="490" cy="262" r="18" id="c-mev" fill="#040810" stroke="#00e5ff" stroke-width="2"/>
          <polygon id="bt-mev-t" points="480,245 490,262 500,245" fill="#00e5ff" opacity="0.75"/>
          <polygon id="bt-mev-b" points="480,279 490,262 500,279" fill="#00e5ff" opacity="0.75"/>
          <text id="st-mev" x="490" y="242" text-anchor="middle" class="cst" fill="#ff3333">CLOSED</text>
          <text x="514" y="266" text-anchor="start" class="clbl" fill="#00e5ff">MEV</text>
        </g>


        <!-- ‚îÄ‚îÄ‚îÄ JUNCTION / PORT DOTS ‚îÄ‚îÄ‚îÄ -->
        <!-- N2O+N2 merge point -->
        <circle id="dot-merge" cx="192" cy="152" r="4.5" fill="#1a2d50"/>
        <!-- N2 elbow base -->
        <circle id="dot-n2el"  cx="192" cy="268" r="4.5" fill="#1a2d50"/>
        <!-- OX left port (QD pipe meets OX wall) -->
        <circle id="dot-oxlp"  cx="453" cy="152" r="3.5" fill="#1a2d50"/>
        <!-- OX bottom port (SOL2 pipe exits OX) -->
        <circle id="dot-oxb"   cx="490" cy="175" r="3.5" fill="#1a2d50"/>
        <!-- CC top port -->
        <circle id="dot-cct"   cx="490" cy="293" r="3.5" fill="#1a2d50"/>

        <!-- MERGE label -->
        <text x="192" y="145" text-anchor="middle" class="clbl" font-size="7" fill="#2a3f60">MERGE</text>

      </svg>
    </div>

    <!-- EVENT LOG -->
    <div class="log-row">
      <div class="log-hdr">
        <div class="stitle" style="border:none;padding:0;margin:0;">‚óà EVENT LOG</div>
        <button onclick="clearLog()" style="background:none;border:1px solid var(--border);color:var(--text-dim);font-family:'Share Tech Mono',monospace;font-size:7px;padding:1px 6px;border-radius:2px;cursor:pointer;letter-spacing:1px;">CLEAR</button>
      </div>
      <div class="log-panel" id="log-panel">
        <div class="lentry"><span class="lt">00:00:00</span><span class="linfo">SYSTEM INIT ¬∑ P&ID REV 3.0 ¬∑ CYLINDER TOPOLOGY LOADED</span></div>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="side-panel right">
    <div class="stitle">‚óà VALVE / ACTUATOR STATUS</div>
    <div class="armed" id="armed-banner">‚ö† ENGINE ARMED ¬∑ MEV OPEN</div>

    <div class="vcard" style="--vc:#ff8c00;" onclick="toggleValve('n2o-valve')">
      <div class="vleft"><div class="vicon">‚äó</div><div><div class="vname">N‚ÇÇO VALVE</div><div class="vid">N2OV ¬∑ N2O FEED</div></div></div>
      <div class="vtoggle"><div class="vpill pclosed" id="pill-n2o-valve">CLOSED</div><div class="tswitch" id="toggle-n2o-valve"><div class="tknob"></div></div></div>
    </div>

    <div class="vcard" style="--vc:#00aaff;" onclick="toggleValve('n2-valve')">
      <div class="vleft"><div class="vicon">‚äó</div><div><div class="vname">N‚ÇÇ VALVE</div><div class="vid">N2V ¬∑ N2 FEED</div></div></div>
      <div class="vtoggle"><div class="vpill pclosed" id="pill-n2-valve">CLOSED</div><div class="tswitch" id="toggle-n2-valve"><div class="tknob"></div></div></div>
    </div>

    <div class="vcard" style="--vc:#bb44ff;" onclick="toggleValve('solenoid-1')">
      <div class="vleft"><div class="vicon">‚ö°</div><div><div class="vname">SOLENOID 1</div><div class="vid">SOL-01 ¬∑ FEED PATH</div></div></div>
      <div class="vtoggle"><div class="vpill pclosed" id="pill-solenoid-1">CLOSED</div><div class="tswitch" id="toggle-solenoid-1"><div class="tknob"></div></div></div>
    </div>

    <div class="vcard" style="--vc:#f39c12;" onclick="toggleValve('quick-disconnect')">
      <div class="vleft"><div class="vicon">‚õì</div><div><div class="vname">QUICK DISCONNECT</div><div class="vid">QD-01 ¬∑ UMBILICAL</div></div></div>
      <div class="vtoggle"><div class="vpill pdisengaged" id="pill-quick-disconnect">DISENGAGED</div><div class="tswitch" id="toggle-quick-disconnect"><div class="tknob"></div></div></div>
    </div>

    <div class="vcard" style="--vc:#bb44ff;" onclick="toggleValve('solenoid-2')">
      <div class="vleft"><div class="vicon">‚ö°</div><div><div class="vname">SOLENOID 2</div><div class="vid">SOL-02 ¬∑ OX PATH</div></div></div>
      <div class="vtoggle"><div class="vpill pclosed" id="pill-solenoid-2">CLOSED</div><div class="tswitch" id="toggle-solenoid-2"><div class="tknob"></div></div></div>
    </div>

    <div class="vcard" style="--vc:#00e5ff;" onclick="toggleValve('main-engine-valve')">
      <div class="vleft"><div class="vicon">üîß</div><div><div class="vname">MAIN ENGINE VALVE</div><div class="vid">MEV-01 ¬∑ MAIN OUT</div></div></div>
      <div class="vtoggle"><div class="vpill pclosed" id="pill-main-engine-valve">CLOSED</div><div class="tswitch" id="toggle-main-engine-valve"><div class="tknob"></div></div></div>
    </div>

    <div style="border-top:1px solid var(--border);margin:3px 0;"></div>
    <div class="stitle">‚óà SYSTEM CONTROLS</div>
    <button class="cbtn" style="background:rgba(0,170,255,0.1);border:1px solid #00aaff;color:#00aaff;" onclick="simStart()">‚ñ∂ START SIMULATION</button>
    <button class="cbtn" style="background:rgba(255,140,0,0.1);border:1px solid #ff8c00;color:#ff8c00;" onclick="simStop()">‚èπ STOP SIMULATION</button>
    <button class="cbtn" style="background:rgba(255,51,51,0.1);border:1px solid #ff3333;color:#ff3333;" onclick="resetAll()">‚Ü∫ RESET ALL</button>

    <div style="border-top:1px solid var(--border);margin:3px 0;"></div>
    <div class="stitle">‚óà INJECT TELEMETRY</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;">
      <div><div class="inj-lbl">N‚ÇÇO (PSI)</div><input type="number" id="inj-n2o" placeholder="0‚Äì1500" class="inj-inp" style="color:#ff5533;"/></div>
      <div><div class="inj-lbl">N‚ÇÇ (PSI)</div> <input type="number" id="inj-n2"  placeholder="0‚Äì1500" class="inj-inp" style="color:#00aaff;"/></div>
      <div><div class="inj-lbl">OX (PSI)</div> <input type="number" id="inj-o2"  placeholder="0‚Äì1500" class="inj-inp" style="color:#00ff88;"/></div>
      <div><div class="inj-lbl">CC (PSI)</div> <input type="number" id="inj-cc"  placeholder="0‚Äì750"  class="inj-inp" style="color:#ff8800;"/></div>
    </div>
    <button class="cbtn" style="background:rgba(0,255,136,0.1);border:1px solid #00ff88;color:#00ff88;margin-top:1px;" onclick="injectTel()">‚¨Ü INJECT</button>
  </div>
</div>

<!-- TOAST NOTIFICATION -->
<div class="toast" id="toast"><span id="t-ico">‚úì</span><span id="t-txt">Done</span></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const MAXP = {n2o:1500,n2:1500,o2:1500,cc:750};
const WARN  = {n2o:1200,n2:1200,o2:1200,cc:600};
const CRIT  = {n2o:1400,n2:1400,o2:1400,cc:700};

const S = {
  tanks : { n2o:{v:0,h:[]}, n2:{v:0,h:[]}, o2:{v:0,h:[]}, cc:{v:0,h:[]} },
  valves: {
    'n2o-valve':         {open:false,type:'valve'},
    'n2-valve':          {open:false,type:'valve'},
    'solenoid-1':        {open:false,type:'solenoid'},
    'solenoid-2':        {open:false,type:'solenoid'},
    'quick-disconnect':  {open:false,type:'qd'},
    'main-engine-valve': {open:false,type:'valve'}
  },
  sim:false, simT:null, ec:0, up:0
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLOCK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ts = () => new Date().toUTCString().split(' ')[4];
setInterval(()=>{ document.getElementById('clock').textContent = ts()+' UTC'; }, 1000);
setInterval(()=>{
  S.up++;
  document.getElementById('t-uptime').textContent =
    String(Math.floor(S.up/60)).padStart(2,'0') + ':' + String(S.up%60).padStart(2,'0');
}, 1000);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TANK UPDATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setTank(k, v) {
  const t = S.tanks[k];
  const prev = t.v;
  t.v = Math.max(0, Math.min(v, MAXP[k]));
  t.h.push(t.v);
  if (t.h.length > 50) t.h.shift();

  const uid  = k;                            // same key used for DOM ids
  const pct  = (t.v / MAXP[k]) * 100;
  const vEl  = document.getElementById(uid+'-val');
  const bEl  = document.getElementById(uid+'-bar');
  if (vEl) vEl.textContent = t.v.toFixed(1);
  if (bEl) bEl.style.width = pct + '%';

  // SVG label
  const svgM = {n2o:'svp-n2o', n2:'svp-n2', o2:'svp-ox', cc:'svp-cc'};
  const sEl  = document.getElementById(svgM[k]);
  if (sEl) sEl.textContent = t.v.toFixed(1) + ' PSI';

  // Trend arrow
  const tEl = document.getElementById(uid+'-trend');
  if (tEl) {
    if      (t.v > prev+0.5) { tEl.textContent='‚Üë'; tEl.style.color='#ff3333'; }
    else if (t.v < prev-0.5) { tEl.textContent='‚Üì'; tEl.style.color='#00ff88'; }
    else                     { tEl.textContent='‚Üî'; tEl.style.color='#4a6080'; }
  }

  // Status badge
  const stEl = document.getElementById(uid+'-status');
  if (stEl) {
    if      (t.v >= CRIT[k]) { stEl.textContent='‚óè CRITICAL'; stEl.className='tstlbl scrit'; log(k.toUpperCase()+' CRITICAL: '+t.v.toFixed(0)+' PSI','err'); }
    else if (t.v >= WARN[k]) { stEl.textContent='‚óè WARNING';  stEl.className='tstlbl swarn'; }
    else                     { stEl.textContent='‚óè NOMINAL';  stEl.className='tstlbl snom';  }
  }

  // Sparkline
  const spM = {n2o:'n2o', n2:'n2', o2:'o2'};
  if (spM[k]) drawSpark(k, spM[k]);

  // Sys avg
  const avg = ((S.tanks.n2o.v + S.tanks.n2.v + S.tanks.o2.v) / 3).toFixed(0);
  document.getElementById('t-sys').textContent = avg;
}

function drawSpark(k, sid) {
  const el = document.getElementById('sp-'+sid);
  if (!el) return;
  const h = S.tanks[k].h;
  if (h.length < 2) return;
  const mx = MAXP[k];
  const pts = h.map((v,i) => ((i/(h.length-1))*200).toFixed(1)+','+(20-(v/mx)*17).toFixed(1)).join(' ');
  el.setAttribute('points', pts);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VALVE TOGGLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleValve(id) {
  const v   = S.valves[id];
  v.open    = !v.open;
  const isQD = v.type === 'qd';
  const lbl  = v.open ? (isQD?'ENGAGED':'OPEN') : (isQD?'DISENGAGED':'CLOSED');

  // Sidebar pill + toggle switch
  const pill = document.getElementById('pill-'+id);
  const tog  = document.getElementById('toggle-'+id);
  if (pill) {
    pill.textContent = lbl;
    pill.className   = 'vpill ' + (v.open ? (isQD?'pengaged':'popen') : (isQD?'pdisengaged':'pclosed'));
  }
  if (tog) tog.classList.toggle('active', v.open);

  // SVG visual
  svgValveUpdate(id, v.open, lbl);
  // Pipe flows
  updatePipes();

  // Counters
  document.getElementById('t-valves').textContent = Object.values(S.valves).filter(x=>x.open).length;
  document.getElementById('armed-banner').classList.toggle('on', S.valves['main-engine-valve'].open);

  log(id.replace(/-/g,' ').toUpperCase()+' ‚Üí '+lbl, v.open?'ok':'warn');
  showToast(v.open?'‚úì':'‚äò', id.replace(/-/g,' ').toUpperCase()+': '+lbl, v.open?'#00ff88':'#ff3333');
}

/* SVG valve visual state */
function svgValveUpdate(id, open, lbl) {
  /* config per valve: circleId, statusTextId, bowtieIds, ownColor */
  const cfg = {
    'n2o-valve':         {ci:'c-n2ov',  si:'st-n2ov', bt:['bt-n2ov-l','bt-n2ov-r'], oc:'#ff8c00'},
    'n2-valve':          {ci:'c-n2v',   si:'st-n2v',  bt:['bt-n2v-l','bt-n2v-r'],   oc:'#00aaff'},
    'solenoid-1':        {ci:'c-sol1',  si:'st-sol1', bt:['bt-sol1-l','bt-sol1-r'], oc:'#bb44ff', box:'box-sol1'},
    'solenoid-2':        {ci:'c-sol2',  si:'st-sol2', bt:['bt-sol2-t','bt-sol2-b'], oc:'#bb44ff', box:'box-sol2'},
    'quick-disconnect':  {special:true, si:'st-qd'},
    'main-engine-valve': {ci:'c-mev',   si:'st-mev',  bt:['bt-mev-t','bt-mev-b'],   oc:'#00e5ff'}
  };
  const c = cfg[id];
  if (!c) return;

  // Status text
  const sEl = document.getElementById(c.si);
  if (sEl) { sEl.textContent = lbl; sEl.setAttribute('fill', open?'#00ff88':'#ff3333'); }

  if (c.special) {
    // QD: arrows show state
    const al = document.getElementById('qd-al'), ar = document.getElementById('qd-ar');
    const lh = document.getElementById('qd-lh'),  rh = document.getElementById('qd-rh');
    if (open) {
      if (al) { al.textContent='‚ü∂'; al.setAttribute('fill','#00ff88'); al.setAttribute('x','311'); }
      if (ar) { ar.textContent='‚üµ'; ar.setAttribute('fill','#00ff88'); ar.setAttribute('x','325'); }
      if (lh) lh.setAttribute('stroke','#00ff88');
      if (rh) rh.setAttribute('stroke','#00ff88');
    } else {
      if (al) { al.textContent='‚üµ'; al.setAttribute('fill','#ff3333'); al.setAttribute('x','315'); }
      if (ar) { ar.textContent='‚ü∂'; ar.setAttribute('fill','#ff3333'); ar.setAttribute('x','321'); }
      if (lh) lh.setAttribute('stroke','#f39c12');
      if (rh) rh.setAttribute('stroke','#f39c12');
    }
    return;
  }

  // Circle fill/stroke
  const cEl = document.getElementById(c.ci);
  if (cEl) {
    cEl.setAttribute('stroke', open ? '#00ff88' : c.oc);
    cEl.setAttribute('fill',   open ? 'rgba(0,255,136,0.12)' : '#0a0d12');
    open ? cEl.setAttribute('filter','url(#fg)') : cEl.removeAttribute('filter');
  }
  // Bowtie triangles
  c.bt && c.bt.forEach(bid => {
    const el = document.getElementById(bid);
    if (el) el.setAttribute('fill', open ? '#00ff88' : c.oc);
  });
  // SOL box
  if (c.box) {
    const b = document.getElementById(c.box);
    if (b) {
      b.setAttribute('stroke', open ? '#00ff88' : '#bb44ff');
      b.setAttribute('fill',   open ? 'rgba(0,255,136,0.1)' : '#0b0814');
    }
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PIPE FLOW ANIMATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOPOLOGY:
   px1  N2O ‚Üí N2OV  (red)
   px2  N2OV ‚Üí merge  (red)
   px3  N2 ‚Üí N2V  (blue)
   px4  N2V ‚Üí elbow  (blue)
   px5  N2 vertical rise ‚Üí merge  (blue)
   px6  merge ‚Üí SOL1  (mixed feed color)
   px8  SOL1 ‚Üí QD  (purple)
   px9  QD ‚Üí corner  (purple)
   px10 corner ‚Üí OX left port  (purple)
   px11 OX bottom ‚Üí SOL2  (green)
   px12 SOL2 ‚Üí MEV  (green)
   px13 MEV ‚Üí CC  (cyan)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setPipe(id, on, color) {
  const el = document.getElementById(id);
  if (!el) return;
  if (on) {
    el.setAttribute('class', 'pipe-on');
    el.setAttribute('stroke', color);
    el.setAttribute('stroke-width', '2.8');
    el.removeAttribute('filter'); // filter applied per-pipe via fEl
  } else {
    el.setAttribute('class', 'pipe');
    el.setAttribute('stroke', '#1a2d50');
    el.setAttribute('stroke-width', '2.5');
    el.removeAttribute('filter');
  }
}

function setDot(id, on, color) {
  const el = document.getElementById(id);
  if (!el) return;
  el.setAttribute('fill', on ? (color||'#00ff88') : '#1a2d50');
  on ? el.setAttribute('filter','url(#fg)') : el.removeAttribute('filter');
}

function updatePipes() {
  const V     = S.valves;
  const n2oOn = V['n2o-valve'].open;
  const n2On  = V['n2-valve'].open;
  const s1On  = V['solenoid-1'].open;
  const qdOn  = V['quick-disconnect'].open;
  const s2On  = V['solenoid-2'].open;
  const mevOn = V['main-engine-valve'].open;

  const feedOn  = n2oOn || n2On;
  const feedCol = (n2oOn && n2On) ? '#cc88ff' : n2oOn ? '#ff5533' : '#00aaff';
  const postS1  = feedOn && s1On;
  const postQD  = postS1 && qdOn;
  const toChamb = mevOn && s2On;

  // N2O feed
  setPipe('px1', n2oOn,  '#ff5533');
  setPipe('px2', n2oOn,  '#ff5533');
  // N2 feed
  setPipe('px3', n2On,   '#00aaff');
  setPipe('px4', n2On,   '#00aaff');
  setPipe('px5', n2On,   '#00aaff');
  // Merged feed ‚Üí SOL1
  setPipe('px6', feedOn, feedCol);
  // SOL1 ‚Üí QD
  setPipe('px8', postS1, '#bb44ff');
  // QD ‚Üí OX left port (straight horizontal)
  setPipe('px9', postQD, '#aa66ff');
  // OX bottom ‚Üí SOL2 ‚Üí MEV ‚Üí CC (vertical line)
  setPipe('px11', s2On,          '#00ff88');
  setPipe('px12', s2On && mevOn, '#00ff88');
  setPipe('px13', toChamb,       '#00e5ff');

  // Junction dots
  setDot('dot-merge', feedOn,        feedCol);
  setDot('dot-n2el',  n2On,          '#00aaff');
  setDot('dot-oxlp',  postQD,        '#aa66ff');
  setDot('dot-oxb',   s2On,          '#00ff88');
  setDot('dot-cct',   toChamb,       '#00e5ff');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function log(txt, type) {
  const p = document.getElementById('log-panel');
  const e = document.createElement('div');
  e.className = 'lentry';
  const cls = {ok:'lok',warn:'lwarn',err:'lerr',info:'linfo'}[type] || 'linfo';
  e.innerHTML = `<span class="lt">${ts()}</span><span class="${cls}">${txt}</span>`;
  p.insertBefore(e, p.firstChild);
  while (p.children.length > 60) p.removeChild(p.lastChild);
  S.ec++;
  document.getElementById('t-events').textContent = S.ec;
}
function clearLog() { document.getElementById('log-panel').innerHTML = ''; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let toastT;
function showToast(ico, txt, col) {
  const el = document.getElementById('toast');
  document.getElementById('t-ico').textContent = ico;
  document.getElementById('t-ico').style.color = col;
  document.getElementById('t-txt').textContent = txt;
  el.style.borderColor = col;
  el.classList.add('show');
  clearTimeout(toastT);
  toastT = setTimeout(() => el.classList.remove('show'), 2400);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIMULATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function simStart() {
  if (S.sim) return;
  S.sim = true;
  S.tanks.n2o.v = 840; S.tanks.n2.v = 920;
  S.tanks.o2.v  = 870; S.tanks.cc.v  = 8;
  log('SIMULATION STARTED ¬∑ LIVE FEED ACTIVE', 'info');
  S.simT = setInterval(() => {
    setTank('n2o', S.tanks.n2o.v + (Math.random()-0.48)*9);
    setTank('n2',  S.tanks.n2.v  + (Math.random()-0.48)*8);
    setTank('o2',  S.tanks.o2.v  + (Math.random()-0.48)*7);
    const mev = S.valves['main-engine-valve'].open;
    setTank('cc', Math.min(750, S.tanks.cc.v + (mev ? Math.random()*5 : -Math.random()*1.5)));
  }, 700);
}
function simStop() {
  if (!S.sim) return;
  S.sim = false;
  clearInterval(S.simT);
  log('SIMULATION STOPPED', 'warn');
}
function resetAll() {
  simStop();
  Object.keys(S.valves).forEach(id => {
    if (S.valves[id].open) { S.valves[id].open = true; toggleValve(id); }
  });
  ['n2o','n2','o2','cc'].forEach(k => { setTank(k, 0); S.tanks[k].h = []; });
  updatePipes();
  log('ALL SYSTEMS RESET ¬∑ SAFE STATE', 'warn');
  showToast('‚Ü∫', 'ALL SYSTEMS RESET', '#ff8c00');
}
function injectTel() {
  const map = [['inj-n2o','n2o'],['inj-n2','n2'],['inj-o2','o2'],['inj-cc','cc']];
  map.forEach(([eid,k]) => {
    const v = parseFloat(document.getElementById(eid).value);
    if (!isNaN(v)) { setTank(k,v); log('INJ '+k.toUpperCase()+': '+v+' PSI','info'); }
  });
  showToast('‚¨Ü','TELEMETRY INJECTED','#00ff88');
}

/*
  ‚îÄ‚îÄ WEBSOCKET HOOK (real telemetry) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const ws = new WebSocket('ws://YOUR_SERVER');
  ws.onmessage = e => {
    const d = JSON.parse(e.data);
    if(d.n2o_psi !== undefined) setTank('n2o', d.n2o_psi);
    if(d.n2_psi  !== undefined) setTank('n2',  d.n2_psi);
    if(d.ox_psi  !== undefined) setTank('o2',  d.ox_psi);
    if(d.cc_psi  !== undefined) setTank('cc',  d.cc_psi);
    Object.entries(d.valves||{}).forEach(([k,open]) => {
      if (S.valves[k] && S.valves[k].open !== open) toggleValve(k);
    });
  };
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
log('GROUND STATION ONLINE ¬∑ ALL SYSTEMS NOMINAL', 'ok');
log('TOPOLOGY: N2O+N2 ‚Üí MERGE ‚Üí SOL1 ‚Üí QD ‚Üí [SOL2 thru OX] ‚Üí MEV ‚Üí CC', 'info');
</script>
</body>
</html>
